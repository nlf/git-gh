#!/usr/bin/env node
var github = require('../lib/github'),
    config = require('../lib/config'),
    repo = require('../lib/repo')[0],
    colors = require('colors'),
    columnizer = require('columnizer'),
    display = new columnizer(),
    comments = new columnizer(),
    opts = require('nomnom').options({
        issue: {
            position: 0,
            help: 'issue ID',
            required: true
        },
        user: {
            position: 1,
            help: 'username',
            required: true
        }
    }).parse();

var request = { user: repo.user, repo: repo.repo };

var issue = opts.issue;
if (isNaN(issue)) {
    console.error('Invalid issue ID (must be a number)');
    process.exit(1);
}

var assignee = opts.user;

request.number = issue;
request.assignee = assignee === 'noone' ? null : assignee;

github.issues.getRepoIssue(request, function (err, msg) {
    if (err) {
        console.error(err.message);
        process.exit(1);
    }
    request.title = msg.title;
    request.labels = msg.labels;
    github.issues.edit(request, function (err, msg) {
        if (err) {
            console.error(err.message);
            process.exit(1);
        }
        console.log('Issue ' + request.number + ' is now assigned to ' + assignee);
    });
});
